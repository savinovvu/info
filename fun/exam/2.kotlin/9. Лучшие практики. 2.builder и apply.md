Идиома "builder" в Kotlin — это подход к созданию объектов с большим количеством параметров, который улучшает читаемость кода и позволяет гибко конфигурировать объекты. Хотя в Kotlin она часто заменяется **default-параметрами и named-arguments**, для интеграции с Java или в DSL (Domain-Specific Language) билдеры всё ещё актуальны. Реализация с помощью `apply` позволяет сделать код лаконичным.

### Как реализовать builder с `apply`
Функция `apply` в Kotlin работает с контекстом объекта (`this`) и возвращает сам объект после применения блока кода. Это идеально для билдеров.

**Пример:**
```kotlin
class Car {
    var brand: String = ""
    var model: String = ""
    var year: Int = 0
    var color: String = ""

    fun display() = println("$brand $model, $year, $color")
}

// Создание объекта через apply
val car = Car().apply {
    brand = "Tesla"
    model = "Model S"
    year = 2022
    color = "Red"
}

car.display() // Вывод: Tesla Model S, 2022, Red
```

### Builder для Java-совместимости или DSL
Если нужен классический билдер (например, для Java-кода):
```kotlin
class Car private constructor(
    val brand: String,
    val model: String,
    val year: Int,
    val color: String
) {
    class Builder {
        private var brand: String = ""
        private var model: String = ""
        private var year: Int = 0
        private var color: String = ""

        fun setBrand(brand: String) = apply { this.brand = brand }
        fun setModel(model: String) = apply { this.model = model }
        fun setYear(year: Int) = apply { this.year = year }
        fun setColor(color: String) = apply { this.color = color }

        fun build() = Car(brand, model, year, color)
    }
}

// Использование
val car = Car.Builder()
    .setBrand("Tesla")
    .setModel("Model 3")
    .setYear(2021)
    .setColor("White")
    .build()
```

### DSL-подход с `apply`
Для сложных конфигураций, особенно в серверном Kotlin (например, Spring Boot конфигурация):
```kotlin
class DatabaseConfig {
    var url: String = ""
    var username: String = ""
    var password: String = ""
    var poolSize: Int = 10
}

fun databaseConfig(block: DatabaseConfig.() -> Unit) = DatabaseConfig().apply(block)

// Использование
val config = databaseConfig {
    url = "jdbc:postgresql://localhost/db"
    username = "admin"
    password = "secret"
    poolSize = 20
}
```

### Итоги
1. **Builder через `apply`** упрощает инициализацию объектов, особенно когда параметров много.
2. **Default-параметры** в Kotlin часто предпочтительнее, но билдеры полезны для:
    - Совместимости с Java.
    - Динамической конфигурации.
    - Создания DSL.
3. **Ключевое преимущество `apply`** — возможность группировки операций инициализации в блоке кода.

Пример из серверного контекста (настройка HTTP-клиента):
```kotlin
class HttpClientConfig {
    var timeout: Int = 5000
    var retries: Int = 3
    var headers: Map<String, String> = emptyMap()
}

fun httpClientConfig(block: HttpClientConfig.() -> Unit) = HttpClientConfig().apply(block)

val config = httpClientConfig {
    timeout = 10000
    retries = 5
    headers = mapOf("User-Agent" to "MyApp")
}
```